<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.laladev.moneyjinn.businesslogic.dao.mapper.IMonthlySettlementDaoMapper">

    	<sql id="monthlySettlementwColumns">
		 monthlysettlementid	AS id
		,mac_id_creator		AS macIdCreator
		,year
		,month
		,amount
		,mcs_capitalsourceid	AS mcsCapitalsourceId
	</sql>
    
    	<select id="getAllYears" resultType="java.lang.Short">
		SELECT DISTINCT year
		  FROM vw_monthlysettlements
		 WHERE maf_id = #{userId}
		 ORDER BY year ASC
	</select>
	
    	<select id="getAllMonth" resultType="java.lang.Short">
		SELECT DISTINCT month
		  FROM vw_monthlysettlements
		 WHERE maf_id = #{userId}
		   AND year   = #{year}
		 ORDER BY year ASC
	</select>
    			
     	<select id="getAllMonthlySettlementsByYearMonth"
		resultType="org.laladev.moneyjinn.businesslogic.dao.data.MonthlySettlementData">
		SELECT <include refid="monthlySettlementwColumns" />
		  FROM vw_monthlysettlements
		 WHERE month  = #{month}
		   AND year   = #{year}
		   AND maf_id = #{userId}
		 ORDER BY CASE WHEN mac_id_creator = #{userId} THEN 1 ELSE 2 END
		      ,mcs_capitalsourceid
	</select>
	
</mapper>
 